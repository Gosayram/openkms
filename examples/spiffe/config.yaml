# OpenKMS Configuration with SPIFFE Authentication
# This example shows how to configure OpenKMS to use SPIFFE for service identity

server:
  address: "0.0.0.0"
  port: 8443
  tls_enabled: true
  tls_cert_file: "/etc/ssl/server.crt"
  tls_key_file: "/etc/ssl/server.key"
  tls_ca_cert_file: "/etc/ssl/ca.crt"
  require_client_cert: true
  read_timeout: "30s"
  write_timeout: "30s"
  idle_timeout: "120s"

storage:
  type: "boltdb"
  path: "/data/openkms.db"

security:
  master_key_provider: "env"
  master_key_env_var: "OPENKMS_MASTER_KEY"
  
  # Authentication configuration
  auth:
    providers:
      - "static"      # For admin API tokens
      - "mtls"        # For regular mTLS certificates
      - "spiffe"       # For SPIFFE SVIDs
    
    # SPIFFE configuration
    spiffe:
      trust_domain: "example.org"
      workload_socket: "/tmp/spire-agent/public/api.sock"
      # Optional: Provide trust bundle files instead of workload API
      # bundle_paths:
      #   - "/etc/spiffe/trust-bundle.pem"
      #   - "/etc/spiffe/backup-bundle.pem"

logging:
  level: "info"
  format: "json"
  output_path: "/var/log/openkms.log"

metrics:
  enabled: true
  path: "/metrics"
  port: 9090

ha:
  enabled: false
  # HA configuration would go here if needed